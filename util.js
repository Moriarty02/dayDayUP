!function(e){var t={rest:function(e){return this.toArray(e,1)},first:function(e){return e&&e[0]},toArray:function(e,t){return e&&[].slice.call(e,t||0)}},n=function(e){for(var t=[],n=0,o=e.length;n<o;n++)t.push("object"==$.type(e[n])?JSON.stringify(e[n]):e[n]);return t};e.cmd=function(e){var o=n(t.rest(arguments));if(window.AndroidWebview&&AndroidWebview[e])return AndroidWebview[e].apply(AndroidWebview,o);window.console&&console.log(e+":"+[].join.call(o,"|"))},e.lib={},e.lib.ArrayUtil=t}(window.qStore||(window.qStore={})),function(e){var t=e.Delay=function(e){this.deferred=$.Deferred(),this.promise=this.deferred.promise(),this.fired=!1,e&&this.willFire(e)};$.extend(t.prototype,{fireReady:function(){this.fired||(this.deferred.resolve.apply(this.deferred,arguments),this.fired=!0)},ready:function(e){this.promise.then(e)},willFire:function(e){var t=this;setTimeout(function(){t.fireReady()},e)}})}(qStore.lib),function(e,t){var n=function(){function e(e){var t=0,n=0,o=e.length-1;for(o;o>=0;o--){var i=parseInt(e.charCodeAt(o),10);t=(t<<6&268435455)+i+(i<<14),0!=(n=266338304&t)&&(t^=n>>21)}return t}var t,n=document,o=navigator,i=window.screen;n.domain.toLowerCase(),o.userAgent.toLowerCase();return t=[e(n.domain),function(){for(var t=[o.appName,o.version,o.language||o.browserLanguage,o.platform,o.userAgent,i.width,"x",i.height,i.colorDepth,n.referrer].join(""),r=t.length,a=window.history.length;a;)t+=a--^r++;return 2147483647*(Math.round(2147483647*Math.random())^e(t))}(),+new Date+Math.random()+Math.random()].join(""),t=t.replace(/\./gi,"e"),t=t.substr(0,32)},o=function(){var t=e.getLocalData("__m2__");return t||(t=n(),e.setLocalData("__m2__",t),t)};e.getClientInfo=function(){var e=t.cmd("getClientInfo")||{};return"string"==typeof e&&(e=JSON.parse(e)),e},e.getQuery=function(){for(var e=window.location.search.substr(1),t=e.split("&"),n={},o=0,i=t.length;o<i;o++){var r,a=t[o].split("=");try{r=decodeURIComponent(a[1])}catch(s){r=a[1]}n[a[0]]=r}return function(e){return void 0===e?n:n[e]}}(),e.getMID=function(){return this.getQuery("m2")||this.getClientInfo().m2||o()},e.showMessage=function(e){window.AndroidWebview?t.cmd("showMessage",e):window.console&&console.log(e)},e.openUrl=function(e){t.cmd("openPage",e)},e.getAppStatus=function(e){return t.app.getStatus(e)},e.format=function(e){var t=1,n=arguments;return String(e).replace(/%s/g,function(){return n[t++]})},e.getProtocol=function(){return"https:"==location.protocol?"https:":"http:"},e.addCSSRules=function(){var e=Array.prototype.join.call(arguments," ");arguments.callee[e]||(arguments.callee[e]=1,/^\s+$/i.test(e)||$("<div />",{html:"&shy;<style>"+e+"</style>"}).appendTo(document.body))},e.cmd=t.cmd,e.log=e.showMessage}(qStore.util={},qStore),function(e){var t={},n=navigator.userAgent;t.is_weixin=/MicroMessenger/i.test(n),t.is_iphone=/(iPhone|ipod|ipad|ios)/i.test(n),t.is_android=/Android/i.test(n),t.is_mobile=t.is_android||t.is_iphone||/Mobile/i.test(n),t.is_pc=!t.is_mobile,t.is_zhushou=/360appstore/i.test(n);var o=new e.lib.Delay;e.ready=function(e){return o.ready(e)},e.ready(function(){if(t.is_zhushou){var n=e.util.getClientInfo();t.network={1:"wifi",2:"wap",4:"wap",3:"net",5:"net",7:"4g","-1":"no-connect"}[n.netType]||"",t.networkType=n.netType,e.cmd("pageFinish")}});var i=new Image,r=!1;i.__defineGetter__&&i.__defineGetter__("id",function(){r=!0}),window.console&&console.log(i),i=null,function(){var n=new e.lib.Delay;if(e.spiritReady=function(e){return n.ready(e)},!t.is_zhushou&&t.is_mobile){if(r&&!t.is_weixin)return void n.fireReady();var o=0;!function i(){if(o++>10)return void n.fireReady();$.ajax({url:e.util.getProtocol()+"//qstore.inner.api.sj.360.cn:38517/getClientInfo?_="+(new Date).getTime(),dataType:"jsonp",success:function(e){t.isRPCWorking=!0,t._127_clientInfo=e,n.fireReady()},error:function(){setTimeout(i,200)}})}()}}(),window.AndroidWebview_clientReady=function(){t.is_zhushou=!0,o.fireReady()};var a=(new Date).getTime();!function(){t.is_zhushou?window.AndroidWebview&&AndroidWebview.getClientInfo?(t.is_zhushou=!0,o.fireReady()):(new Date).getTime()-a>2e3?o.fireReady():setTimeout(arguments.callee,30):o.fireReady()}(),e.env=t}(window.qStore),function(e){var t=null,n=0,o=e.support={init:function(){t=e.util.getClientInfo(),n=t.version},pause:function(){return 1},has:function(e){return window.AndroidWebview&&AndroidWebview[e]}};e.ready(o.init)}(window.qStore),function(e,t){var n=function(){try{return!!window.localStorage}catch(e){return!1}}(),o=function(e,o){if(!(arguments.length<2)){var i=JSON.stringify({__type__:"qstore-data",__value__:o});n?localStorage.setItem(e,i):window.AndroidWebview&&t.cmd("saveData",e,i)}},i=function(e){var o="";n?o=localStorage.getItem(e):window.AndroidWebview&&(o=t.cmd("getData",e,""));try{return o=JSON.parse(o),o.__type__&&"qstore-data"==o.__type__?o.__value__:o}catch(i){return o}};e.setLocalData=function(e,t){return o(e,t)},e.getLocalData=function(e){if(void 0!==e)return i(e)},e.delLocalData=function(e){e&&(n&&localStorage.removeItem(e),window.AndroidWebview&&t.cmd("saveData",e,""))}}(qStore.util,window.qStore),function(e){var t=function(e,t,n){var o,i,r,a;return arguments.length>1&&"[object Object]"!==String(t)?(n=n||{},null!==t&&t!==undefined||(n.expires=-1),"number"==typeof n.expires?(o=24*n.expires*60*60*1e3,i=n.expires=new Date,i.setTime(i.getTime()+o)):(n.expiresAt,n.expires=n.expiresAt),t=String(t),n.path=n.path||"/",n.domain=n.domain||document.domain,document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")):(n=t||{},a=n.raw?function(e){return e}:decodeURIComponent,(r=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?a(r[1]):null)};e.setCookie=function(e,n,o){return"number"==$.type(o)&&(o={expires:o}),t(e,n,o)},e.getCookie=function(e){return t(e)},e.delCookie=function(e){return t(e,null)}}(qStore.util),function(e){var t=[],n=!1,o={getPageHref:function(){return location.protocol+"//"+location.host+location.pathname},getRefer:function(){return e.getQuery("refer")},getLogUrl:function(t,n,o,i){var r={u:this.getPageHref(),ver:"",mid:e.getQuery("m")||e.getMID(),cid:"",from:"",market_id:"360market",tj:"",refer:""},a={sid:t||"",act:n||"",pos:o||"",_:(new Date).getTime()},s={};s=$.extend(s,r),s=$.extend(s,i||{}),s=$.extend(s,a);return"http://s.360.cn/zhushou/soft.html?"+$.param(s)},request:function(e){if(!this.hamal){var i=this.hamal=document.createElement("img");i.style.visibility="hidden",i.style.width=i.style.height="1px",i.style.position="absolute",i.style.left="-1000px",document.body.appendChild(i),i.onload=i.onerror=function(){n=!1,t.length>0&&o.request(t.shift())}}if(n)return void t.push(e);n=!0,this.hamal.src=e},record:function(){var e=this.getLogUrl.apply(this,arguments);this.request(e)}};e.record=function(){return o.record.apply(o,arguments)}}(qStore.util),function(e){window.QSTORE_EVENT_LOGIN_CHANGE="qstore-login-change",window.QSTORE_EVENT_LOGIN="qstore-try-login";var t=window.onLoginChanged;window.onLoginChanged=function(e){qStore.ready(function(){t&&t(e),qStore.trigger(QSTORE_EVENT_LOGIN_CHANGE,[e])})},e.hasLogin=function(){return!!qStore.util.getCookie("Q")},e.tryLogin=function(t){if(this.hasLogin())return this.getUserInfo(t);if(qStore.env.is_zhushou){var n=$.Deferred(),o=n.promise(),i=this;return qStore.one(QSTORE_EVENT_LOGIN,function(e,o){o?i.getUserInfo(function(e){t&&t(e),n.resolve(e)}):(t&&t(!1),n.reject(!1))}),qStore.one(QSTORE_EVENT_ACTIVITY_RESUME,function(t){setTimeout(function(){qStore.trigger(QSTORE_EVENT_LOGIN,[e.hasLogin()])},10)}),qStore.cmd("tryLogin","noop"),o}window.location="http://i.360.cn/login/wap?destUrl="+encodeURIComponent(location.href)},e.getUserInfo=function(e){var t=$.Deferred(),n=t.promise(),o=function(o){return e&&e(o),o?t.resolve(o):t.reject(o),n};if(!this.hasLogin())return o(!1);if(qStore.env.is_zhushou){var i=JSON.parse(qStore.cmd("getCurrentUserInfo")||"{}");if(i.avatar)return o(i)}return $.ajax({url:"http://js.login.360.cn/?o=sso&m=info&time="+(new Date).getTime(),jsonpCallback:"func",dataType:"jsonp",success:function(e){e.name=e.nickname||e.userName||e.username,e.avatar=e.img_url,o(e)},error:function(){o(!1)}}),n}}(qStore.util),function(e){var t={},n=function(e){return!0};t.getButtonLabel=function(e,t){return""},t.getButtonHTML=function(e,t){return""},t.getAppData=function(e){return e},t.downloadable=n,t.pauseable=n,t.openable=n,e.getDownloadPlugin=function(){return t}}(window.qStore),function(e,t){window.QSTORE_EVENT_ACTIVITY_RESUME="activity-resume",window.QSTORE_EVENT_ACTIVITY_CLOSE="activity-close",window.QSTORE_EVENT_ACTIVITY_PAUSE="activity-pause";var n=window.Zepto?Zepto("<div></div>"):jQuery({});window.AndroidWebview_onResume=function(){n.trigger(QSTORE_EVENT_ACTIVITY_RESUME)},window.AndroidWebview_onPause=function(){n.trigger(QSTORE_EVENT_ACTIVITY_PAUSE)};var o=$.Event(QSTORE_EVENT_ACTIVITY_CLOSE);window.onBackKeyDown=function(){n.trigger(o),o.isDefaultPrevented()||(t.cmd("setOnBackKeyDownListenner",0),setTimeout(function(){t.cmd("close")},10)),o=$.Event(QSTORE_EVENT_ACTIVITY_CLOSE)};var i=function(){t.cmd("setResumePauseLinnersenr",1)},r=function(){t.cmd("setOnBackKeyDownListenner",1)},a=function(){t.cmd("setOnBackKeyDownListenner",0)},s=function(e){e==QSTORE_EVENT_ACTIVITY_RESUME?i():e==QSTORE_EVENT_ACTIVITY_CLOSE&&r()};e.trigger=function(e,t){return n.trigger(e,t)},e.off=function(e){return e==QSTORE_EVENT_ACTIVITY_CLOSE&&a(),n.off.apply(n,arguments)},e.on=function(e){return s(e),n.on.apply(n,arguments)},e.one=function(e){return s(e),n.one.apply(n,arguments)},$.extend(t,e),$(document).on("click","a",function(e){var n=location.href.replace(/#.*$/i,""),o=this.href.replace(/#.*$/i,"");e.isDefaultPrevented()||n==o||/^https?:/i.test(o)&&t.cmd("setOnBackKeyDownListenner",0)})}(qStore.event={},qStore),function(e){var t={},n={},o={},i={0:"download",490:"download",190:"waiting",191:"waiting",196:"waiting",197:"installing",198:"installing",199:"installing",3000:"installing",1:"open",189:"downloading",192:"pause",193:"resume",200:"install",10240:"update",10495:"nonet"},r={download:"\u4e0b\u8f7d",update:"\u5347\u7ea7",open:"\u6253\u5f00",pause:"\u6682\u505c",resume:"\u7ee7\u7eed",install:"\u5b89\u88c5",downloading:"\u4e0b\u8f7d\u4e2d",installing:"\u5b89\u88c5\u4e2d",waiting:"\u7b49\u5f85\u4e2d",nonet:"\u7b49\u5f85\u4e2d"},a=["pname","soft_id","soft_name","logo_url","download_urls","version_code","apk_sizes","signature_md5s","apk_md5s","type","baike_name","is_g","package_count"],s=function(e){var t={pname:"apkid",soft_name:"name",download_urls:"down_url",signature_md5s:"signature_md5",apk_sizes:"size",apk_md5s:"apk_md5"};for(var n in t)e[n]&&(e[t[n]]=e[n],delete e[n]);return e},u=!1,d={init:function(){u=e.support.pause(),e.cmd("addDownloadListenner"),e.cmd("setInstallReceiver",1),this._getNotInstalledPackage(),e.cmd("getInstatllApp","setAppStatus")},getLocalPackage:function(e){return e?n[e]:n},getInstalledPackage:function(e){return e?o[e]:o},_getNotInstalledPackage:function(){for(var t=JSON.parse(e.cmd("getDownloadApp")||"[]"),o=0,i=t.length;o<i;o++)n[t[o].pkgName]=t[o];return n},_setInstalledPackage:function(e){o=e},updateLocalPackageInfo:function(e,i){"added"==e?(o[i]=(t[i]||{}).version_code||o[i]||Infinity,delete n[i]):"removed"==e&&(delete o[i],this._getNotInstalledPackage())},getButtonLabel:function(e){return r[e]||"\u4e0b\u8f7d"},getAction:function(e){return"192"==e?u?"pause":"downloading":i[e]||"download"},hasInstalled:function(e){return!!o[e]},hasDownloaded:function(e){return!!n[e]},getAppStatus:function(e,t){if(t=t||-1,this.hasInstalled(e))return o[e]<t?10240:1;var i=n[e];if(i){if(i.versionCode&&i.versionCode<t)return 0;var r=i.status;if(r){if("193"==r||"196"==r)return 193;if("192"==r)return 192}return 200}return 0},clearAppData:function(e){t[e]&&(t[e]=null)},addAppData:function(e){function n(e){e&&e.apkid&&(t[e.apkid]=t[e.soft_id]=e)}if("array"==$.type(e))for(var o=0,i=e.length;o<i;o++)n(e[o]);else n(e)},getAppData:function(n,o,i){var r=$.Deferred();if(i&&t[n])r.resolve(t[n]);else{var u,d,c;"string"==$.type(n)&&(n=n.split(/\s*,\s*/i)),"number"==$.type(n)&&(n=[n]),u=/^\d+$/i.test(n[0])?"getSoftInfoByIdsAccordingToFields/sids/":"getSoftInfoByPnamesAccordingToFields/pnames/","string"==$.type(o)&&(o=o.split(/\s*,\s*/i)),o=o||a,d="//openbox.mobilem.360.cn/index/"+u,c=e.util.getProtocol()+d+n.join("|")+"/fields/"+o.join("|"),$.ajax({url:c,dataType:"jsonp",success:function(e){var n=[];for(var o in e)e.hasOwnProperty(o)&&(e[o]=s(e[o]),n.push(e[o]));i?(t[n[0].apkid]=t[n[0].soft_id]=n[0],r.resolve(n[0])):r.resolve(n,e)}})}return r.promise()},getCachedAppData:function(){return t},getAppStatusLabel:function(){return r}};e.getPackageMgr=function(){return d},window.QSTORE_EVENT_APP_DOWNLOADING="qstore-app-downloading",window.QSTORE_EVENT_APP_INSTALL_FINISH="qstore-app-install-finish",window.QSTORE_EVENT_APP_DOWNLOAD_FINISH="qstore-app-download-finish",window.QSTORE_EVENT_APP_CHANGE="qstore-app-change";var c=window.updateAppDownloadProgress,l={};window.updateAppDownloadProgress=function(i){c&&c(i);var r;for(var a in i)i.hasOwnProperty(a)&&(r=i[a],"3000"==r.status?"3000"!=l[a]&&(e.event.trigger(QSTORE_EVENT_APP_DOWNLOAD_FINISH,[r]),e.one(QSTORE_EVENT_ACTIVITY_RESUME,function(e){setTimeout(function(){"200"!=l[a]&&"1"!=l[a]&&(d.hasInstalled(a)||(i[a].status="200",i[a].isSimulateProgress=1,window.updateAppDownloadProgress(i)))},10)})):"192"==r.status?n[a]=r:"200"==r.status?(n[a]=r,r.isSimulateProgress||e.event.trigger(QSTORE_EVENT_APP_DOWNLOAD_FINISH,[r])):"1"==r.status?(o[a]=r.version_code||(t[a]||{}).version_code||Infinity,delete n[a],e.event.trigger(QSTORE_EVENT_APP_INSTALL_FINISH,[r])):"193"==r.status&&(n[a]=r),l[a]=r.status);e.event.trigger(QSTORE_EVENT_APP_DOWNLOADING,[i,r])};var p=window.AppInstallAction;window.AppInstallAction=function(t){p&&p(t);var o=t.pkgname;if(d.updateLocalPackageInfo(t.action,o),"added"==t.action){var i={};i[o]=n[o]||{},i[o].status="1",window.updateAppDownloadProgress(i)}e.event.trigger(QSTORE_EVENT_APP_CHANGE,[t])};var f=window.AndroidWebview_removePackage;window.AndroidWebview_removePackage=function(t,n){f&&f(t),n="true"==e.cmd("isInstalled",t)?"added":"removed",d.updateLocalPackageInfo(n,t),e.event.trigger(QSTORE_EVENT_APP_CHANGE,[{action:n,pkgname:t}])};var g=new e.lib.Delay;e.ready2=function(e){return g.ready(e)};var w=window.setAppStatus;window.setAppStatus=function(e){w&&w(e),d._setInstalledPackage(e),g.fireReady()},e.ready(function(){d.init(),window.AndroidWebview||g.fireReady()})}(window.qStore),function(){var e=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height);for(var o=n.getImageData(0,0,e.width,e.height),i=o.data,r=[],a=0;a<i.length;a++)if(a%4!=3){if(0==i[a])break;r.push(String.fromCharCode(i[a]))}var s=r.join(""),u=s.replace(/\\u([^\\]{2,4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))});try{return JSON.parse(u)}catch(d){return{}}},t=function(e){return"https:"==location.protocol&&e.indexOf(":38517")>0},n=function(t,n,o){var i,r=function(){i&&(i=i.onreadystatechange=i.onload=i.onerror=null)};return{send:function(o,a){i=new Image,i.crossOrigin="Anonymous",i.onerror=n.error,i.onreadystatechange=i.onload=function(){this.readyState&&!/loaded|complete/i.test(this.readyState)||(a&&a(e(this)),r())},i.src=t.url},abort:function(){r()}}};if(window.jQuery&&$.ajaxTransport("https-transport",n),window.Zepto){var o=$.ajaxJSONP;$.ajaxJSONP=function(e,i){if(!t(e.url))return o.apply($,arguments);var r,a=n(e,e),s={abort:function(){a.abort()}};return e.timeout>0&&(r=setTimeout(s.abort,e.timeout)),a.send({},function(t){r&&clearTimeout(r),e.success&&e.success(t)}),s}}var i=$.ajax;$.ajax=function(e){return t(e.url)&&(e.url=e.url.replace(/^https/i,"http"),e.data=$.extend(e.data||{},{protocol:"https"}),window.jQuery&&(e.type="https-transport")),i.apply($,arguments)}}(),function(e){var t=function(e,t){var n=$.Deferred();return $.ajax({url:"//openbox.mobilem.360.cn/qing/spiritkey?key="+encodeURIComponent(e),dataType:"jsonp",success:function(e){t&&t(e.sign),n.resolve(e.sign)}}),n.promise()},n={download:function(n,o){return t(n.down_url).then(function(t){var i={url:n.down_url,sign:t,logo:n.logo_url,name:n.name},r=e.util.getProtocol()+"//qstore.inner.api.sj.360.cn:38517/in?";return $.ajax({url:r,data:i,dataType:"jsonp",success:function(){o&&o(!0)}})})},openPage:function(t,n){n=n||function(){},$.ajax({url:e.util.getProtocol()+"//qstore.inner.api.sj.360.cn:38517/openPage?needCookie=1&url="+encodeURIComponent(t)+"&_="+Math.random(),dataType:"jsonp",success:function(e){n(!0)},error:function(e){n()}})},hasInstalled:function(n,o){return t(n).then(function(t){return $.ajax({url:e.util.getProtocol()+"//qstore.inner.api.sj.360.cn:38517/isAppInstalled",data:{packageName:n,sign:t},dataType:"jsonp",success:function(e){o&&o(e.isInstalled)},error:function(){o&&o(!1)}})})},getClientInfo:function(){return e.env._127_clientInfo||{}}};e.spirit=n}(window.qStore),function(e,t){var n=function(e){return"ebook"==e.type&&e.cpbook_id&&e.cpbook_detailurl&&window.AndroidWebview&&AndroidWebview.openCPBook},o=t.getDownloadPlugin(),i=t.getPackageMgr(),r=t.event,a=function(e){n(e)?t.cmd("openCPBook",e):t.cmd("downloadApp",e)};e.download=function(t){var n=$.type(t);if("string"==n||"number"==n)return void e.downloadFromId(t);var i=o.downloadable(t);if(!1!==i){var s="number"==typeof i?i:30;setTimeout(function(){var e=o.getAppData($.extend({},t));"object"==$.type(e)&&$.isPlainObject(e)||(e=t),a(e),r.trigger("qstore-app-download",[e])},s)}},e.downloadFromId=function(t){return i.getAppData(t,null,!0).then(function(t){e.download(t)})},e.open=function(e){if("string"==$.type(e))return i.getAppData(e,null,!0).then(function(e){t.app.open(e)});var a=o.openable(e);!1!==a&&setTimeout(function(){r.trigger("qstore-app-open",[e]),n(e)?t.cmd("openCPBook",e):t.cmd("launchApp",{apkid:e.apkid})},"number"==typeof a?a:0)},e.pause=function(e){o.pauseable(e)&&(t.cmd("pauseDownloadApp",e.apkid),r.trigger("qstore-app-pause",[e]))},e.resume=function(e){this.download(e),r.trigger("qstore-app-resume",[e])},e.install=function(e){"string"==typeof e&&(e={apkid:e});var n=i.getLocalPackage(e.apkid),o=!1;return n||(o=!0),n.downPath=n.downPath||n.savePath||"",window.AndroidWebview&&AndroidWebview.installAppFormFile?1!=t.cmd("installAppFormFile",n.downPath)&&(o=!0):t.cmd("installAppFormId",n.id),o?(t.util.showMessage("\u5b89\u88c5\u5931\u8d25\uff0c\u8bf7\u60a8\u91cd\u65b0\u4e0b\u8f7d"),window.AppInstallAction({action:"removed",pkgname:e.apkid}),!1):(r.trigger("qstore-app-install",[e]),!0)},e.gotoDetail=function(e){i.getAppData(e,null,!0).then(function(e){r.trigger("qstore-app-to-detail",[e]),t.cmd("gotoPage",$.extend({page:"detail"},e))})},e.getStatus=function(){return i.getAppStatus.apply(i,arguments)},e.addData=function(e){return i.addAppData(e)},e.getData=function(e,t){var n="array"==$.type(e)||"string"==$.type(e)&&e.split(",").length>1;return i.getAppData(e,t).then(function(e,t){return n?e:e[0]})}}(qStore.app={},qStore),function(e){var t=e.getDownloadPlugin(),n=e.getPackageMgr(),o=e.util,i=function(e){var t={};return(e.attr("class")||"").replace(/([^\s]+)/g,function(e,n){t[n]=1}),t},r=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},a=n.getAppStatusLabel(),s=new RegExp("(?:^|\\s+)is-("+r(a).join("|")+")(?:\\s+|$)","ig"),u={init:function(){this.appBtnList=document.getElementsByClassName?document.getElementsByClassName("js-app-btn"):[],this.bindEvents()},downloadInZhushou:function(t,n,o){s.lastIndex=0,n["is-download"]||n["is-resume"]||n["is-update"]||!o.match(s)?e.app.download(t):n["is-open"]?e.app.open(t):n["is-pause"]?e.app.pause(t):n["is-install"]&&e.app.install(t)},bindEvents:function(){var t=$(document),o=this;t.on("click",".js-app-btn",function(t){var r,a,s=$(t.target),u=s.closest(".js-app-item"),d=$(this);if(t.preventDefault(),!(r=u.data("apkid")||d.data("apkid")))return e.util.showMessage("\u672a\u627e\u5230\u5e94\u7528\u5305\u540d");if(a=n.getAppData(r,null,!0),e.env.is_zhushou)a.then(function(e){o.downloadInZhushou(e,i(d),d.attr("class"))});else if(e.env.isRPCWorking&&e.spirit)a.then(function(t){e.trigger("web-download-start",[t]),e.spirit.download(t)});else if(e.env.is_weixin||e.env.is_qq)a.then(function(t){e.trigger("web-download-failed",[t])});else{var c=d[0].href;/\.apk$/i.test(c)?window.location.href=c:a.then(function(e){window.location.href=e.down_url})}}),t.on("click",".js-app-item",function(t){var n=$(t.target),o=n.closest("a");if(!$(this).is(".js-app-btn")&&(0==o.length||o[0]==this)){var i=$(this).data("apkid");i||(i=$(this).find(".js-app-btn").data("apkid")),i?e.app.gotoDetail(i):window.console&&console.log("\u672a\u627e\u5230APKID"),t.preventDefault()}}),t.on("click",".js-app-link",function(t){if(e.env.is_zhushou){var n=$(this)[0].href||$(this).data("href")||"";n.length>0&&e.util.openUrl(n),t.preventDefault()}}),e.event.on(QSTORE_EVENT_APP_DOWNLOADING,function(e,t){for(var n in t)t.hasOwnProperty(n)&&o.updateStatus(n,t[n])}),e.event.on(QSTORE_EVENT_APP_CHANGE,function(e,t){o.updateStatus(t.pkgname,{progress:"0",status:"removed"==t.action?"490":"1"})})},updateStatus:function(e,o){var i=n.getAction(o.status);if("waiting"!=i){var o={apkid:e,version:o.version_code,action:i,progress:o.progress,speed:o.speed,status:o.status},r=t.getButtonHTML(i,o)||this.getButtonHTML(i,o),a=this.getButtonsByApkid(e),s=this;$.each(a,function(e,t){s.setButtonHTML(t,o,r)})}},setButtonHTML:function(e,n,o){var i=n.action,o=o||t.getButtonHTML(i,n)||this.getButtonHTML(i,n),r=e.attr("class");s.lastIndex=0,s.test(r)?r=r.replace(s,function(e,t){return" is-"+(a[t]?i:t)+" "}).replace(/^\s+/i,""):r+=" is-"+i,e.html(o).attr("class",$.trim(r))},checkAppStatus:function(){var e=this,t={};$(".js-app-btn").each(function(){var o=$(this),i=o.closest(".js-app-item"),r=i.data("apkid")||o.data("apkid"),a=i.data("ver")||o.data("ver")||-1,s=n.getAppStatus(r,a);s>0&&(-1==a&&1==s&&(t[r]=1),e.setButtonHTML(o,{apkid:r,version:a,action:n.getAction(s),progress:0}))})},getButtonsByApkid:function(e){var t=[],n=function(n){(n.data("apkid")||n.closest(".js-app-item").data("apkid"))==e&&t.push(n)},o=this.appBtnList.length;if(o>0)for(var i=0;i<o;i++)n($(this.appBtnList[i]));else $(".js-app-btn").each(function(e,t){n($(t))});return t},getButtonHTML:function(e,i){var r=i.progress,a=t.getButtonLabel(e,i)||n.getButtonLabel(e,i);o.addCSSRules(".o-progress.isHide {display:none !important;}");var s="_progress o-progress";return"download"!=e&&"resume"!=e&&"install"!=e&&"open"!=e||(s+=" isHide"),['<span class="_icon"></span>','<span class="'+s+'">','<i class="_bar" style="width:'+(r||0)+'%;"></i>',"</span>",'<span class="_label">'+a+"</span>"].join("")}};u.init(),e.ready2(function(){$(function(){u.checkAppStatus()})}),e.web=u}(window.qStore),function(e,t){var n,o=!1,i=new t.lib.Delay,r=$.Deferred(),a=r.promise(),s=function(){i.fireReady()};window.QSTORE_EVENT_SHARE_FINISH="qstore-share-finish";var u=function(e){t.trigger(QSTORE_EVENT_SHARE_FINISH,[e])},d=function(e){t.off(QSTORE_EVENT_SHARE_FINISH+".internal"),t.on(QSTORE_EVENT_SHARE_FINISH+".internal",function(t,n){e(n)})},c={run:function(){t.env.is_weixin||(u(!0),setTimeout(function(){location.href="http://service.weibo.com/share/share.php?title="+n.weixinTitle+"&url="+n.weixinUrl+"&pic="+n.weiboImg+"&appkey=4051837633&searchPic=false"},30))},setWXShareCallback:function(){wx.onMenuShareTimeline({title:n.weixin,link:n.weixinUrl,imgUrl:n.weixinThumbnailUrl,success:function(){u(!0)},cancel:function(){u(!1)}}),wx.onMenuShareAppMessage({title:n.weixinTitle,desc:n.weixin,link:n.weixinUrl,imgUrl:n.weixinThumbnailUrl,trigger:function(e){},success:function(){u(!0)},cancel:function(){u(!1)},fail:function(e){u(!1)}})},getWXConfig:function(){$.ajax({url:t.util.getProtocol()+"//huodong.mobilem.360.cn/weixin/getWeixinJsConfig",data:{format:"json",url:location.href.split("#")[0]},dataType:"jsonp",success:function(e){i.ready(function(){c.setupWxConfig(e.data),r.resolve()})}})},loadWXAPI:function(e){if(window.wx&&wx.config)return s();if(!o){o=!0,e=t.util.getProtocol()+"//res.wx.qq.com/open/js/jweixin-1.0.0.js";var n=document.createElement("script");n.onload=s,n.onreadystatechange=function(){/loaded|complete/i.test(this.readyState)&&s()},n.src=e,$(document.body).append(n)}},init:function(){t.env.is_weixin&&(this.loadWXAPI(),this.getWXConfig())},setupWxConfig:function(e){wx.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","scanQRCode","startRecord","stopRecord","onVoiceRecordEnd","translateVoice","chooseImage","previewImage","uploadImage","downloadImage"]})}};c.init(),e.setData=function(e,t){var o=e.link||location.href,i=e.title||document.title,r=e.content||document.title,s=e.logo||e.img||"http://p19.qhimg.com/t01b792441769dbca78.png",u={"default":e.weibo||r+" "+o,weixin:r,weixinUrl:o,weixinTitle:i,weixinThumbnailUrl:s,localPic:e.localPic||"",weiboImg:e.weiboImg||s||"",needMonitor:!0};e.extra&&(u=$.extend(u,e.extra)),n=u,a.then(function(){wx.ready(function(){c.setWXShareCallback()})}),t&&d(t)},e.run=function(e,t){if("function"==$.type(e)&&(t=e,e=!1),n&&!e||this.setData(e||{}),t&&d(t),!window.AndroidWebview)return void c.run(n);window.AndroidWebview_onShareDone=function(e){u("true"===e)},setTimeout(function(){AndroidWebview.simpleShareToSNS?AndroidWebview.simpleShareToSNS(JSON.stringify(n)):AndroidWebview.shareToSNS(JSON.stringify({imgUrl:n.weixinThumbnailUrl,content:n.weixin}))},10)},t.util.share=function(){return e.run.apply(e,arguments)}}(qStore.share={},window.qStore);